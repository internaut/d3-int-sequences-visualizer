<!DOCTYPE html>
<meta charset="utf-8">
<style>
	body {
		font: 10px sans-serif;
        background: black;
        color: white;
	}

    svg {
        background: black;
        border: 1px solid white;
    }

    .section text {
        font-size: 22px;
        font-weight: bold;
        fill: white;
    }

    .connection {
        stroke: white;
        fill: none;
    }
</style>
<body>
<script src="d3.js" charset="utf-8"></script>

<script>
    /**
     * TODOs:
     * - make interpolate fn selectable
     * - make constant selectable: pi, euler, etc.
     * - draw symbol of constant in background
     * - allow to enter own constant
     */

    var width = 700,
        height = 700,
        innerRadius = Math.min(width, height) * .4,
        outerRadius = innerRadius * 1.1;

    var from0to9 = [];
    for (var i = 0; i < 10; i++) {
        from0to9.push(String(i));
    }

    var from0to9ArcData = [];
    from0to9.forEach(function (digit, i) {
        var arcDataObj = {
            index: i,
            value: digit,
            startAngle: Math.PI * .2 * i,
            endAngle: Math.PI * .2 * (i + 1)
        };

        from0to9ArcData.push(arcDataObj);
    });


    var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

    var fillPerDigit = d3.scale.category10().domain(d3.range(0, 10));

    var arc = d3.svg.arc()
            .innerRadius(innerRadius)
            .outerRadius(outerRadius);

    var section = svg.append("g").selectAll(".section")
            .data(from0to9ArcData)
            .enter().append("g")
            .attr("class", "section");

    var sectionPath = section.append("path")
            .attr("id", function(d, i) { return "section" + i; })
            .attr("d", arc)
            .attr("centroid", arc.centroid)
            .style("fill", function(d, i) { return fillPerDigit(i); })
            .style("stroke", function(d, i) { return fillPerDigit(i); });

    var sectionText = section.append("text")
            .attr("x", 93)
            .attr("dy", 21);
    sectionText.append("textPath")
            .attr("xlink:href", function(d, i) { return "#section" + i; })
            .text(function(d) { return d.value; });



    d3.text('pi.txt', function (content) {
        var dotIdx = content.indexOf('.') + 1;
        var fromDot = content.substr(dotIdx);
        var digits = fromDot.replace(/[\D]/g, '');

        drawDigits('141592');
    });

    function drawDigits(digits) {
        var connection = svg.append("g").attr("class", "connection");

        var line = d3.svg.line()
                .x(function (d) { return d[0] })
                .y(function (d) { return d[1] })
                .interpolate("basis");

        var middlePoint = [0, 0];
        var prevPoint = null;
        for (var i = 0; i < digits.length; i++) {
            var dgt = digits.charAt(i);
            var section = svg.select("#section" + dgt);
            var secCentroid = section.attr("centroid").split(",");
            var thisPoint = [parseFloat(secCentroid[0]), parseFloat(secCentroid[1])];

            if (prevPoint != null) {
                var connectionLine = connection.append("path").attr("d", line([prevPoint, middlePoint, thisPoint]));
            }

            prevPoint = thisPoint;
        }
    }
</script>

</body>
